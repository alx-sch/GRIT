generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User can host events
// User can attend events
// User can add locations
model User {
  id            Int         @id @default(autoincrement())
  createdAt     DateTime    @default(now())
  email         String      @unique
  password      String
  name          String?
  avatarKey     String?

  events        Event[]     @relation("EventAuthor")
  attending     Event[]     @relation("EventAttendees")
  location      Location[]

  chatMessages  ChatMessage[]
}

// Location has a creator
// Location can have events
model Location {
  id          Int         @id @default(autoincrement())
  author      User        @relation(fields: [authorId], references: [id])
  authorId    Int
  name        String?
  city        String?
  country     String?
  longitude   Float
  latitude    Float
  isPublic    Boolean     @default(false)
  events      Event[]
}

// Event must have a creator
// Event can have attending users
// Event can have a location
model Event {
  id            Int         @id @default(autoincrement())
  createdAt     DateTime    @default(now())
  content       String?
  endAt         DateTime
  isPublic      Boolean     @default(true)
  isPublished   Boolean     @default(false)
  startAt       DateTime
  title         String
  imageKey      String?

  author        User       @relation("EventAuthor", fields: [authorId], references: [id])
  authorId      Int

  attending     User[]      @relation("EventAttendees")

  locationId    Int?
  location      Location?   @relation(fields: [locationId], references: [id])

  chatMessages  ChatMessage[]
}

model ChatMessage {
  id            String      @id
  eventId       Int
  authorId      Int
  text          String
  sentAt        DateTime
  createdAt     DateTime    @default(now())

  author        User        @relation(fields: [authorId], references: [id])
  event         Event       @relation(fields: [eventId], references: [id])

  @@index([eventId, createdAt])
}
